<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Glassbro</title>
<link>https://glassbro.blog/index.html#category=R</link>
<atom:link href="https://glassbro.blog/index-r.xml" rel="self" type="application/rss+xml"/>
<description>Data, Politics, etc.</description>
<generator>quarto-1.3.450</generator>
<lastBuildDate>Wed, 11 Jan 2023 05:00:00 GMT</lastBuildDate>
<item>
  <title>Working with the National Transit Database</title>
  <link>https://glassbro.blog/posts/001_intro-ntd/index.html</link>
  <description><![CDATA[ 




<p>This post is the start of a series I’ll write on the <a href="https://www.transit.dot.gov/ntd">National Transit Database</a> (NTD).</p>
<p>The NTD is a series of Excel spreadsheets released annually, around early November, by the Federal Transit Administration (FTA). For now, I’m interested specifically in <a href="https://www.transit.dot.gov/ntd/ntd-data?field_product_type_target_id=All&amp;year=all&amp;combine=breakdowns">breakdowns data</a>. In this post, I’ll describe the breakdowns data set’s structure and demonstrate how I clean it using R.</p>
<p>In later posts, I’ll use NTD data to talk about transit in the US.</p>
<section id="getting-started" class="level2">
<h2 class="anchored" data-anchor-id="getting-started">Getting Started</h2>
<p>I download<sup>1</sup> the <a href="https://www.transit.dot.gov/ntd/data-product/2021-breakdowns">2021 breakdowns dataset</a> and import it into an R session:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># To clean data.</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(knitr)   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For pretty data tables.</span></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(readxl)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Guess.</span></span>
<span id="cb1-4"></span>
<span id="cb1-5">url <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://www.transit.dot.gov/sites/fta.dot.gov/files/2022-10/2021%20Breakdowns_static.xlsx"</span></span>
<span id="cb1-6">tmp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tempfile</span>()</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">download.file</span>(url, tmp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mode =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wb"</span>)</span>
<span id="cb1-8">ntd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> readxl<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_excel</span>(tmp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sheet =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Breakdowns"</span>)</span>
<span id="cb1-9"></span>
<span id="cb1-10">dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glimpse</span>(ntd)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,249
Columns: 30
$ Agency                                             &lt;chr&gt; "MTA New York City …
$ City                                               &lt;chr&gt; "Brooklyn", "Brookl…
$ State                                              &lt;chr&gt; "NY", "NY", "NY", "…
$ `Legacy NTD ID`                                    &lt;chr&gt; "2008", "2008", "20…
$ `NTD ID`                                           &lt;dbl&gt; 20008, 20008, 20008…
$ `Organization Type`                                &lt;chr&gt; "Subsidiary Unit of…
$ `Reporter Type`                                    &lt;chr&gt; "Full Reporter", "F…
$ `Primary UZA Population`                           &lt;dbl&gt; 18351295, 18351295,…
$ `Agency VOMS`                                      &lt;dbl&gt; 10075, 10075, 10075…
$ Mode                                               &lt;chr&gt; "DR", "HR", "CB", "…
$ `Type of Service`                                  &lt;chr&gt; "PT", "DO", "DO", "…
$ `Mode VOMS`                                        &lt;dbl&gt; 878, 5410, 433, 322…
$ `Major Mechanical Failures`                        &lt;dbl&gt; 935, 2257, 440, 979…
$ `Major Mechanical Failures Questionable`           &lt;lgl&gt; NA, NA, NA, NA, NA,…
$ `Other Mechanical Failures`                        &lt;dbl&gt; 691, 12732, 94, 230…
$ `Other Mechanical Failures Questionable`           &lt;lgl&gt; NA, NA, NA, NA, NA,…
$ `Total Mechanical Failures`                        &lt;dbl&gt; 1626, 14989, 534, 1…
$ `Total Mechanical Failures Questionable`           &lt;lgl&gt; NA, NA, NA, NA, NA,…
$ `Vehicle/Passenger Car Miles`                      &lt;dbl&gt; 29546888, 341593245…
$ `Vehicle/Passenger Car Miles Questionable`         &lt;chr&gt; NA, NA, NA, NA, NA,…
$ `Vehicle/Passenger Car Revenue Miles`              &lt;dbl&gt; 23722953, 331253516…
$ `Vehicle/Passenger Car Revenue Miles Questionable` &lt;chr&gt; NA, NA, NA, NA, NA,…
$ `Train Miles`                                      &lt;dbl&gt; 0, 37477972, 0, 0, …
$ `Train Miles Questionable`                         &lt;lgl&gt; NA, NA, NA, NA, NA,…
$ `Train Revenue Miles`                              &lt;dbl&gt; 0, 36328789, 0, 0, …
$ `Train Revenue Miles Questionable`                 &lt;lgl&gt; NA, NA, NA, NA, NA,…
$ `Any Data Questionable?`                           &lt;chr&gt; "No", "No", "No", "…
$ ...28                                              &lt;dbl&gt; NA, NA, 1, NA, NA, …
$ `0`                                                &lt;chr&gt; "Hide Questionable …
$ ...30                                              &lt;dbl&gt; NA, NA, 1, NA, NA, …</code></pre>
</div>
</div>
<p>My purposes need just certain fields and records:</p>
<ul>
<li><p><strong>Primary keys:</strong> It’s better if I demonstrate what each record represents in the next section.</p>
<ul>
<li><p><code>NTD ID</code>: Unique agency ID number.</p></li>
<li><p><code>Mode</code>: Transit type. Train, plane, or automobile? I only have energy to cover a few:</p>
<ul>
<li><p>Bus (MB)</p></li>
<li><p>Commuter Rail (CR)</p></li>
<li><p>Heavy Rail (HR)</p></li>
<li><p>Light Rail (LR)</p></li>
</ul></li>
<li><p><code>Type of Service</code>: Whether the transit was Purchased Transit (PT) (contracted out to a private firm) or Directly Operated (DO) (in-house).</p></li>
</ul></li>
<li><p><strong>Identifying info:</strong></p>
<ul>
<li><p><code>Agency</code>: Agency name and nickname/acronym, if it has one (e.g., Metra, WMATA).</p></li>
<li><p><code>City</code>: Agency HQ municipality.</p></li>
<li><p><code>State</code>: Agency HQ state.</p></li>
</ul></li>
<li><p><strong>Metrics:</strong></p>
<ul>
<li><p><code>Mean Miles Between Breakdowns</code> [calculated]: Breakdown frequency. <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7BVRM%7D%7BTotal%20Mechanical%20Failures%7D"></p></li>
<li><p><code>Total Mechanical Failures</code>: Breakdowns. <img src="https://latex.codecogs.com/png.latex?%7BMajor%20Mechanical%20Failures%7D%20+%20%7BOther%20Mechanical%20Failures%7D"></p>
<ul>
<li>No <code>0</code> values, since this is the denominator in my calculated metric.</li>
</ul></li>
<li><p><code>Vehicle/Passenger Car Revenues Miles</code> (VRM): Total miles run in revenue service.</p>
<ul>
<li>No <code>0</code> values. I only want transit that actually runs.</li>
</ul></li>
</ul></li>
<li><p><strong>Quality flags:</strong> Indicate data that don’t meet the FTA’s quality standards. <code>"Q"</code> if data quality is questionable. <code>"W"</code> if the agency didn’t report this data to the FTA’s standards, but the FTA gave them a waiver.</p>
<ul>
<li><p><code>Total Mechanical Failures Questionable</code></p>
<ul>
<li>No <code>"Q"</code> values.</li>
</ul></li>
<li><p><code>Vehicle/Passenger Car Revenue Miles Questionable</code></p>
<ul>
<li>No <code>"Q"</code> values.</li>
</ul></li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">ntd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> ntd <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-2">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(</span>
<span id="cb3-3">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">NTD ID</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>,</span>
<span id="cb3-4">    Mode,</span>
<span id="cb3-5">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Type of Service</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>,</span>
<span id="cb3-6">    Agency,</span>
<span id="cb3-7">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">HQ City</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> City,</span>
<span id="cb3-8">    State,</span>
<span id="cb3-9">    dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vehicle/Passenger Car Revenue Miles"</span>),</span>
<span id="cb3-10">    dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Mechanical Failures"</span>)</span>
<span id="cb3-11">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-12">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="cb3-13">    Mode <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CR"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HR"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"LR"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MB"</span>),</span>
<span id="cb3-14">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Vehicle/Passenger Car Revenue Miles Questionable</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"W"</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA_character_</span>),</span>
<span id="cb3-15">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Vehicle/Passenger Car Revenue Miles</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb3-16">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Total Mechanical Failures Questionable</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"W"</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA_character_</span>),</span>
<span id="cb3-17">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Total Mechanical Failures</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb3-18">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-19">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb3-20">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get agency nickname only.</span></span>
<span id="cb3-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Agency =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".*dba: "</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, Agency),</span>
<span id="cb3-22">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Mean Miles Between Breakdowns</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Vehicle/Passenger Car Revenue Miles</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Total Mechanical Failures</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span></span>
<span id="cb3-23">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-24">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Mode) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-25">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Rank =</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min_rank</span>(dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Mean Miles Between Breakdowns</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-26">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-27">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(Mode, Rank)</span>
<span id="cb3-28"></span>
<span id="cb3-29">ntd <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-30">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(Mode, Rank, Agency, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">HQ City</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, State, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Type of Service</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Mean Miles Between Breakdowns</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-31">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(Mode <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CR"</span>, Rank <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-32">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb3-33">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Mean Miles Between Breakdowns</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">comma</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Mean Miles Between Breakdowns</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>)</span>
<span id="cb3-34">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-35">  knitr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>()</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 40%">
<col style="width: 8%">
<col style="width: 4%">
<col style="width: 13%">
<col style="width: 24%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Mode</th>
<th style="text-align: right;">Rank</th>
<th style="text-align: left;">Agency</th>
<th style="text-align: left;">HQ City</th>
<th style="text-align: left;">State</th>
<th style="text-align: left;">Type of Service</th>
<th style="text-align: left;">Mean Miles Between Breakdowns</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CR</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Northern New England Passenger Rail Authority</td>
<td style="text-align: left;">Portland</td>
<td style="text-align: left;">ME</td>
<td style="text-align: left;">PT</td>
<td style="text-align: left;">2,105,053</td>
</tr>
<tr class="even">
<td style="text-align: left;">CR</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">Pennsylvania Department of Transportation</td>
<td style="text-align: left;">Harrisburg</td>
<td style="text-align: left;">PA</td>
<td style="text-align: left;">PT</td>
<td style="text-align: left;">1,619,575</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CR</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">MTA Metro-North Railroad</td>
<td style="text-align: left;">New York</td>
<td style="text-align: left;">NY</td>
<td style="text-align: left;">DO</td>
<td style="text-align: left;">910,686</td>
</tr>
<tr class="even">
<td style="text-align: left;">CR</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">Northern Indiana Commuter Transportation District</td>
<td style="text-align: left;">Chesterton</td>
<td style="text-align: left;">IN</td>
<td style="text-align: left;">DO</td>
<td style="text-align: left;">764,272</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CR</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">MTA Long Island Rail Road</td>
<td style="text-align: left;">Jamaica</td>
<td style="text-align: left;">NY</td>
<td style="text-align: left;">DO</td>
<td style="text-align: left;">748,705</td>
</tr>
<tr class="even">
<td style="text-align: left;">CR</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">Metra</td>
<td style="text-align: left;">Chicago</td>
<td style="text-align: left;">IL</td>
<td style="text-align: left;">DO</td>
<td style="text-align: left;">536,836</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CR</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">Trinity Metro</td>
<td style="text-align: left;">Fort Worth</td>
<td style="text-align: left;">TX</td>
<td style="text-align: left;">PT</td>
<td style="text-align: left;">488,962</td>
</tr>
<tr class="even">
<td style="text-align: left;">CR</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">Metra</td>
<td style="text-align: left;">Chicago</td>
<td style="text-align: left;">IL</td>
<td style="text-align: left;">PT</td>
<td style="text-align: left;">478,091</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CR</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">Caltrain</td>
<td style="text-align: left;">San Carlos</td>
<td style="text-align: left;">CA</td>
<td style="text-align: left;">PT</td>
<td style="text-align: left;">223,990</td>
</tr>
<tr class="even">
<td style="text-align: left;">CR</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">North County Transit District</td>
<td style="text-align: left;">Oceanside</td>
<td style="text-align: left;">CA</td>
<td style="text-align: left;">PT</td>
<td style="text-align: left;">195,749</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="what-each-record-represents" class="level2">
<h2 class="anchored" data-anchor-id="what-each-record-represents">What Each Record Represents</h2>
<p>Note that each record is a mode-agency-service. Here’s a smaller data set to demonstrate:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">ntd <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-2">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="cb4-3">    Mode <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CR"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"LR"</span>),</span>
<span id="cb4-4">    Agency <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"New Jersey Transit Corporation"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Metra"</span>)</span>
<span id="cb4-5">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-6">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(Mode, Agency, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">HQ City</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, State, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Type of Service</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Total Mechanical Failures</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-7">  knitr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>()</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 5%">
<col style="width: 33%">
<col style="width: 8%">
<col style="width: 6%">
<col style="width: 17%">
<col style="width: 28%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Mode</th>
<th style="text-align: left;">Agency</th>
<th style="text-align: left;">HQ City</th>
<th style="text-align: left;">State</th>
<th style="text-align: left;">Type of Service</th>
<th style="text-align: right;">Total Mechanical Failures</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CR</td>
<td style="text-align: left;">Metra</td>
<td style="text-align: left;">Chicago</td>
<td style="text-align: left;">IL</td>
<td style="text-align: left;">DO</td>
<td style="text-align: right;">30</td>
</tr>
<tr class="even">
<td style="text-align: left;">CR</td>
<td style="text-align: left;">Metra</td>
<td style="text-align: left;">Chicago</td>
<td style="text-align: left;">IL</td>
<td style="text-align: left;">PT</td>
<td style="text-align: right;">35</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CR</td>
<td style="text-align: left;">New Jersey Transit Corporation</td>
<td style="text-align: left;">Newark</td>
<td style="text-align: left;">NJ</td>
<td style="text-align: left;">DO</td>
<td style="text-align: right;">409</td>
</tr>
<tr class="even">
<td style="text-align: left;">LR</td>
<td style="text-align: left;">New Jersey Transit Corporation</td>
<td style="text-align: left;">Newark</td>
<td style="text-align: left;">NJ</td>
<td style="text-align: left;">PT</td>
<td style="text-align: right;">257</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LR</td>
<td style="text-align: left;">New Jersey Transit Corporation</td>
<td style="text-align: left;">Newark</td>
<td style="text-align: left;">NJ</td>
<td style="text-align: left;">DO</td>
<td style="text-align: right;">124</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Metra runs 2 Commuter Rail (CR) services, one in-house (Directly Operated [DO]) and one contracted out (Purchased Transit [PT]).</p>
<p>NJ Transit runs just 1 CR service directly, but 2 Light Rail (LR) services. The DO service is the River Line and Newark LR combined; the PT service is the Hudson-Bergen LR.</p>
<p>Hopefully this clarifies what a mode-agency-service record is.</p>
</section>
<section id="the-big-guys" class="level2">
<h2 class="anchored" data-anchor-id="the-big-guys">The Big Guys</h2>
<p>I pay special attention to the largest agency-services, those running the most VRM. For each mode, I rank the 10 largest agency-services by breakdown frequency.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">biggest <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> ntd <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-2">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Mode) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-3">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">top_n</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Vehicle/Passenger Car Revenue Miles</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-4">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Rank, 10 Biggest</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min_rank</span>(dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Mean Miles Between Breakdowns</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-5">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-6">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">NTD ID</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, Mode, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Type of Service</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Rank, 10 Biggest</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>)</span>
<span id="cb5-7"></span>
<span id="cb5-8">ntd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(ntd, biggest, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"NTD ID"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mode"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Type of Service"</span>))</span>
<span id="cb5-9"></span>
<span id="cb5-10">ntd <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-11">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(Mode <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CR"</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Rank, 10 Biggest</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-12">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(</span>
<span id="cb5-13">    Mode,</span>
<span id="cb5-14">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Rank, 10 Biggest</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>,</span>
<span id="cb5-15">    Agency,</span>
<span id="cb5-16">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">HQ City</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>,</span>
<span id="cb5-17">    State,</span>
<span id="cb5-18">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Type of Service</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>,</span>
<span id="cb5-19">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Mean Miles Between Breakdowns</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span></span>
<span id="cb5-20">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-21">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Mean Miles Between Breakdowns</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">comma</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Mean Miles Between Breakdowns</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-22">  knitr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>()</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 3%">
<col style="width: 12%">
<col style="width: 36%">
<col style="width: 9%">
<col style="width: 4%">
<col style="width: 11%">
<col style="width: 21%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Mode</th>
<th style="text-align: right;">Rank, 10 Biggest</th>
<th style="text-align: left;">Agency</th>
<th style="text-align: left;">HQ City</th>
<th style="text-align: left;">State</th>
<th style="text-align: left;">Type of Service</th>
<th style="text-align: left;">Mean Miles Between Breakdowns</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CR</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">MTA Metro-North Railroad</td>
<td style="text-align: left;">New York</td>
<td style="text-align: left;">NY</td>
<td style="text-align: left;">DO</td>
<td style="text-align: left;">910,686</td>
</tr>
<tr class="even">
<td style="text-align: left;">CR</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">MTA Long Island Rail Road</td>
<td style="text-align: left;">Jamaica</td>
<td style="text-align: left;">NY</td>
<td style="text-align: left;">DO</td>
<td style="text-align: left;">748,705</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CR</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">Metra</td>
<td style="text-align: left;">Chicago</td>
<td style="text-align: left;">IL</td>
<td style="text-align: left;">DO</td>
<td style="text-align: left;">536,836</td>
</tr>
<tr class="even">
<td style="text-align: left;">CR</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">Metra</td>
<td style="text-align: left;">Chicago</td>
<td style="text-align: left;">IL</td>
<td style="text-align: left;">PT</td>
<td style="text-align: left;">478,091</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CR</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">Caltrain</td>
<td style="text-align: left;">San Carlos</td>
<td style="text-align: left;">CA</td>
<td style="text-align: left;">PT</td>
<td style="text-align: left;">223,990</td>
</tr>
<tr class="even">
<td style="text-align: left;">CR</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">Metrolink</td>
<td style="text-align: left;">Los Angeles</td>
<td style="text-align: left;">CA</td>
<td style="text-align: left;">PT</td>
<td style="text-align: left;">175,324</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CR</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">New Jersey Transit Corporation</td>
<td style="text-align: left;">Newark</td>
<td style="text-align: left;">NJ</td>
<td style="text-align: left;">DO</td>
<td style="text-align: left;">138,067</td>
</tr>
<tr class="even">
<td style="text-align: left;">CR</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">Southeastern Pennsylvania Transportation Authority</td>
<td style="text-align: left;">Philadelphia</td>
<td style="text-align: left;">PA</td>
<td style="text-align: left;">DO</td>
<td style="text-align: left;">134,939</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CR</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">Massachusetts Bay Transportation Authority</td>
<td style="text-align: left;">Boston</td>
<td style="text-align: left;">MA</td>
<td style="text-align: left;">PT</td>
<td style="text-align: left;">77,850</td>
</tr>
<tr class="even">
<td style="text-align: left;">CR</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">Denver Regional Transportation District</td>
<td style="text-align: left;">Denver</td>
<td style="text-align: left;">CO</td>
<td style="text-align: left;">PT</td>
<td style="text-align: left;">19,564</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>And that’s it. I’ll post my full rankings soon. In another upcoming post I’ll cover why I’m doing this in the first place.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>An enterprising young programmer could build an R/Python/etc package that automatically downloads NTD data, cleans it, and loads as a DataFrame. The <code>tidycensus</code> R package does this well for ACS and decennial Census data.↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>Transit</category>
  <category>R</category>
  <guid>https://glassbro.blog/posts/001_intro-ntd/index.html</guid>
  <pubDate>Wed, 11 Jan 2023 05:00:00 GMT</pubDate>
  <media:content url="https://www.transit.dot.gov/sites/fta.dot.gov/files/NTD_LineGraph.jpg" medium="image" type="image/jpeg"/>
</item>
</channel>
</rss>
